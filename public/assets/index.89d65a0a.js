import{m as e,r as t,i as a,R as r,P as n,I as s,B as o,L as c,a as l,b as i,c as u,T as m,d,e as f,M as p,f as g,g as h,D as E,h as x,j as v,k as b,l as w,n as k,o as y}from"./vendor.4d13dc9d.js";class C{constructor(e,t,a){this.sender=e,this.text=t,this.date=new Date(a)}}class S{constructor(e,t,a){this.stream=e,this.target=t,this.username=a}}const D=(e,t,a)=>{e&&e.getTracks().forEach((e=>{e.kind===t&&(e.enabled=a)}))},R=e((e=>({nav:{position:"fixed",width:"100%",bottom:"0",background:"#111",height:"65px",display:"flex",alignItems:"center",justifyContent:"center","& button":{color:"#fff",margin:"0 10px",background:"#333"},"& .bgRed":{background:"#f00","&:hover":{filter:"brightness(.8)"}}},chatbox:{position:"fixed",width:"420px",height:"calc(100vh - 65px)",right:"0",top:"0","& .form":{position:"absolute",bottom:"0",width:"100%",display:"flex",borderTop:"1px solid rgba(0,0,0,.2)"},"& .input":{flexGrow:"1",padding:`5px ${e.spacing(1)}px`}}})));function T(e){const[v,b]=t.exports.useState(""),[w,k]=t.exports.useState(!1),[y,T]=t.exports.useState(!0),[N,M]=t.exports.useState(!1),[I,P]=t.exports.useState([]),j=t.exports.useRef(null),L=t.exports.useRef(null),B=t.exports.useRef(null),O=t.exports.useRef(null),Y=t.exports.useRef(null),q=R(),[X,A]=t.exports.useState(""),[W,$]=t.exports.useState("room1"),[F,H]=t.exports.useState([]),U=t.exports.useRef(null),z=t.exports.useRef(null),G=t.exports.useRef(null),[J,V]=t.exports.useState(null),K=t.exports.useRef({}),Q=t.exports.useCallback(((e,t,a)=>{console.log("addstreams ",a);const r=new S(e.streams[0],t,a);H((e=>[...e.filter((e=>e.stream.id!==r.stream.id)),r]))}),[]),Z=t.exports.useCallback(((e,t)=>{e.candidate?U.current.emit("ice-candidate",{target:t.target,candidate:e.candidate}):console.log(`peer ${t.target} connected`)}),[]),_=(e,t)=>{const a=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]});return a.onicecandidate=e=>{Z(e,a)},a.ontrack=a=>{Q(a,e,t)},a.onnegotiationneeded=()=>{(async e=>{const t=await e.createOffer();await e.setLocalDescription(t),U.current.emit("offer",{offer:e.localDescription,target:e.target})})(a)},a.target=e,a};t.exports.useEffect((()=>(U.current=a("http://localhost:5001"),U.current.on("connect",(()=>{console.log("socket connection established")})),G.current.onclick=async()=>{const e=await new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((t=>{e(t)})).catch((()=>{t()}))}));V(e);for(const t in K.current)e.getTracks().forEach((a=>{K.current[t].addTrack(a,e)}))},L.current.onclick=async()=>{const e=await new Promise(((e,t)=>{navigator.mediaDevices.getDisplayMedia({video:!0}).then((t=>{e(t)})).catch((()=>{t()}))}));V(e);for(const t in K.current)e.getTracks().forEach((a=>{K.current[t].addTrack(a,e)}))},B.current.onclick=()=>{const e=O.current.captureStream(30),t=e.getVideoTracks()[0];for(const a in K.current)K.current[a].addTrack(t,e);V(e),M(!0)},()=>{U.current.close()})),[]),t.exports.useEffect((()=>{const e=O.current,t=e.getContext("2d");let a=!1,r=0,n=0;function s(e,t,a,r,n){e.beginPath(),e.strokeStyle="red",e.lineWidth=3,e.moveTo(t,a),e.lineTo(r,n),e.stroke(),e.closePath()}e.addEventListener("mousedown",(e=>{r=e.offsetX,n=e.offsetY,a=!0})),e.addEventListener("mousemove",(e=>{!0===a&&(s(t,r,n,e.offsetX,e.offsetY),r=e.offsetX,n=e.offsetY)})),e.addEventListener("mouseup",(e=>{!0===a&&(s(t,r,n,e.offsetX,e.offsetY),r=0,n=0,a=!1)}))}),[]),t.exports.useEffect((()=>{j.current.onsubmit=e=>{e.preventDefault(),""!==v.trim()&&(U.current.emit("chat",{text:v.trim()}),b(""))}}),[v]),t.exports.useEffect((()=>{U.current.on("chat",(({sender:e,text:t,date:a})=>{const r=new C(e,t,a);console.log("new message recieved",r),P((e=>[...e,r]))})),U.current.on("answer",(async({answer:e,target:t})=>{await K.current[t].setRemoteDescription(new RTCSessionDescription(e))})),U.current.on("ice-candidate",(({incoming:e,target:t})=>{const a=new RTCIceCandidate(e);K.current[t].addIceCandidate(a)})),U.current.on("user-disconnected",(e=>{H((t=>t.filter((t=>t.target!==e))))})),U.current.on("offer",(async({offer:e,target:t,username:a})=>{const r=new RTCSessionDescription(e);console.log("offer username",a),K.current[t]||(K.current[t]=_(t,a)),await K.current[t].setRemoteDescription(r);const n=await K.current[t].createAnswer();await K.current[t].setLocalDescription(n),U.current.emit("answer",{answer:n,target:t})}))}),[]),t.exports.useEffect((()=>{U.current.on("new-user-joined",(async({target:e,username:t})=>{if(console.log("join username",t),K.current[e]=_(e,t),J)J.getTracks().forEach((t=>{K.current[e].addTrack(t,J)}));else{const t=await K.current[e].createOffer();await K.current[e].setLocalDescription(t),U.current.emit("offer",{offer:K.current[e].localDescription,target:K.current[e].target})}}))}),[J]);const ee=(e,t)=>{t(e.target.value)};return r.createElement(n,{square:!0,className:"container"},r.createElement("div",{className:"main"},r.createElement("form",{onSubmit:e=>{e.preventDefault(),U.current.emit("join-room",{username:X,roomID:W})},className:"formContainer"},r.createElement(s,{value:X,onChange:e=>{ee(e,A)},required:!0,placeholder:"username..."}),r.createElement("br",null),r.createElement(s,{value:W,onChange:e=>{ee(e,$)},required:!0,placeholder:"room..."}),r.createElement(o,{type:"submit"},"Join")),r.createElement("div",{className:"streamsContainer",style:{gridTemplateColumns:`repeat(${Math.floor(Math.log((J?1:0)+F.length===1?1:(J?1:0)+F.length)/Math.log(2))+1}, minmax(0, 1fr))`}},r.createElement("div",{className:"vidContainer self whiteboardContainer",style:{display:N?"flex":"none"}},r.createElement("canvas",{width:"560",height:"360",className:"vid",id:"whiteboard",ref:O}),r.createElement("div",{className:"buttonsContainer"},r.createElement(o,{component:"label"},"Image",r.createElement("input",{type:"file",onChange:()=>{const e=O.current.getContext("2d"),t=Y.current.files[0],a=new FileReader;a.readAsDataURL(t),a.onload=t=>{if(t.target.readyState===FileReader.DONE){const a=new Image;a.src=t.target.result,a.onload=()=>{e.drawImage(a,0,0,560,360)}}}},ref:Y,hidden:!0})))),J&&!N&&r.createElement("div",{className:"vidContainer self"},r.createElement("div",{className:"username"},"You "),r.createElement("video",{className:"vid",ref:e=>{if(e)return e.srcObject=J},muted:!0,autoPlay:!0,playsInline:!0})),F.map((({stream:e,username:t})=>r.createElement("div",{className:"vidContainer",key:e.id},r.createElement("div",{className:"username"},t," "),r.createElement("video",{className:"vid",ref:t=>{if(t)return t.srcObject=e},muted:!0,autoPlay:!0,playsInline:!0})))))),r.createElement(n,{square:!0,className:q.chatbox},r.createElement("div",{className:"messages"},r.createElement(c,{subheader:r.createElement(l,{component:"div"},"CHAT")},I.map(((e,t)=>r.createElement(i,{key:t},r.createElement(u,{primary:e.sender,secondary:r.createElement(m,{variant:"body2",noWrap:!0,color:"textSecondary"},e.text)}),r.createElement(d,null,r.createElement("div",{className:"status"},e.date.getHours()+":"+e.date.getMinutes()))))))),r.createElement("form",{className:"form",ref:j},r.createElement(s,{className:"input",placeholder:"Message...",value:v,onChange:e=>{b(e.target.value)},variant:"outlined"}),r.createElement(f,{type:"submit","aria-label":"Send Message"},r.createElement(p,null)))),r.createElement(n,{className:q.nav},r.createElement(f,{onClick:()=>{D(J,"audio",y),T(!y)},"aria-label":"Share Microphone"},y?r.createElement(g,null):r.createElement(h,null)),r.createElement(f,{onClick:()=>{D(J,"video",w),k(!w)},"aria-label":"Share Desktop",ref:z},w?r.createElement(E,null):r.createElement(x,null)),r.createElement(o,{ref:G},"Share webcam"),r.createElement(o,{ref:L},"Share Desktop"),r.createElement(o,{ref:B},"Create Whiteboard")))}function N(){const[e,a]=t.exports.useState(!0),n=v({props:{MuiButtonBase:{disableRipple:!0}},palette:{type:e?"dark":"light",primary:{main:e?"#757575":"#01579B"},secondary:{light:"#0066ff",main:"#0044ff",contrastText:"#ffcc00"}},shape:{borderRadius:0},overrides:{MuiPaper:{elevation1:{background:e?"#21242b":null,"box-shadow":"0 0px 15px 0 rgba(0,0,0,.08)"}}}});return r.createElement(b,{theme:n},r.createElement(w,null,r.createElement(k,{exact:!0,path:"/",component:()=>r.createElement(T,{setDarkTheme:a,darkTheme:e})})))}y.render(r.createElement(r.StrictMode,null,r.createElement(N,null)),document.getElementById("root"));
