var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;import{m as s,r as l,i as o,R as c,P as i,I as u,B as m,T as d,a as f,L as p,S as g,C as h,b as E,G as x,c as v,d as w,e as C,f as b,g as k,h as y,j as S,k as N,D,l as T,n as R,o as I,p as P,M,q as Y,s as O,t as j,u as A,v as F,w as X,x as B,y as q,z as $,A as H,E as L}from"./vendor.57430f27.js";const z=["#000000","#E53935","#CFD8DC","#8E24AA","#303F9F","#0097A7","#FFEB3B","#76FF03","#4FC3F7","#CE93D8"],U=s((e=>({nav:{position:"fixed",width:"100%",bottom:"0",background:"#111",height:"65px",display:"flex",alignItems:"center",justifyContent:"center","& button":{color:"#fff",margin:"0 10px",background:"#333"},"& .bgRed":{background:"#f00","&:hover":{filter:"brightness(.8)"}}},sidebar:{display:"flex",flexDirection:"column",position:"fixed",width:"420px",height:"calc(100vh - 65px)",right:"0",top:"0","& .form":{display:"flex"},"& .input":{flexGrow:"1",padding:`5px ${e.spacing(1)}px`},"& .messages":{overflowY:"scroll",flexGrow:1},"& .listHeader, & .form":{background:"#21242B"}}})));class W{constructor(e,t,n,r,a,s,l,o){this.id=e,this.sender=t,this.text=n,this.date=new Date(r),this.role=a,this.rate=s,this.hardness=l,this.repliedID=o}}class G{constructor(e,t,n){this.stream=e,this.target=t,this.username=n}}class Q{constructor(e,t){this.username=e,this.connectionID=t}}const J=(e,t,n)=>{e&&e.getTracks().forEach((e=>{e.kind===t&&(e.enabled=n)}))},V=({id:e,role:t,onClick:n,text:r,date:a,sender:s,hardness:o,repliedText:i,isAdmin:u,ratingOnChange:m,rate:d})=>{let f=!1;const p=[];let g;"question"===t?(f=!0,p.push("question"),g=`Question (Hardness: ${o})`):"answer"===t?(p.push("answer"),g=`${s} (Replied to: ${i})`):g=s;const[h,E]=l.exports.useState(d);return c.createElement(y,{button:f,onClick:n},c.createElement(S,{className:p.join(" "),primary:g,secondary:c.createElement(c.Fragment,null,c.createElement(N,{component:"span",style:{display:"block"},variant:"body2",noWrap:!0,color:"textSecondary"},r),"answer"===t&&u&&c.createElement(F,{className:"rating",name:`answer-rating${e}`,value:h,onChange:(e,t)=>{E(t),m(t)},size:"small"}),"answer"===t&&!u&&c.createElement(F,{className:"rating",name:`answer-rating${e}`,value:d,size:"small",readOnly:!0}))}),c.createElement(X,null,c.createElement("div",{className:"status"},a.getHours()+":"+a.getMinutes())))};function K(e){var s;const[F,X]=l.exports.useState("room1"),[B,q]=l.exports.useState(""),[$,H]=l.exports.useState(""),[L,K]=l.exports.useState(!1),[Z,_]=l.exports.useState(!0),[ee,te]=l.exports.useState(!1),[ne,re]=l.exports.useState([]),[ae,se]=l.exports.useState([]),[le,oe]=l.exports.useState(!1),[ce,ie]=l.exports.useState([]),[ue,me]=l.exports.useState(null),[de,fe]=l.exports.useState(null),[pe,ge]=l.exports.useState(!1),[he,Ee]=l.exports.useState(!1),[xe,ve]=l.exports.useState(5),[we,Ce]=l.exports.useState(null),[be,ke]=l.exports.useState(4),[ye,Se]=l.exports.useState(z[0]),[Ne,De]=l.exports.useState(!1),Te=l.exports.useRef(null),Re=l.exports.useRef({}),Ie=l.exports.useRef(null),Pe=l.exports.useRef(null),Me=l.exports.useRef(null),Ye=l.exports.useRef(null),Oe=U(),je=l.exports.useCallback(((e,t,n)=>{console.log("addstreams ",n);const r=new G(e.streams[0],t,n);ie((e=>[...e.filter((e=>e.stream.id!==r.stream.id)),r]))}),[]),Ae=l.exports.useCallback(((e,t)=>{e.candidate&&Te.current.emit("ice-candidate",{target:t.target,candidate:e.candidate})}),[]),Fe=(e,t)=>{const n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]});return n.onicecandidate=e=>{Ae(e,n)},n.ontrack=n=>{je(n,e,t)},n.onnegotiationneeded=()=>{(async e=>{const t=await e.createOffer();await e.setLocalDescription(t),Te.current.emit("offer",{offer:e.localDescription,target:e.target})})(n)},n.target=e,n},Xe=e=>{const t=e.getContext("2d");let n=!1,r=0,a=0;const s=(e,t,n,r,a)=>{e.beginPath(),e.lineWidth=3,e.moveTo(t,n),e.lineTo(r,a),e.stroke(),e.closePath()};e.onmousedown=e=>{r=e.offsetX,a=e.offsetY,n=!0},e.onmousemove=e=>{!0===n&&(s(t,r,a,e.offsetX,e.offsetY),r=e.offsetX,a=e.offsetY)},e.onmouseup=e=>{!0===n&&(s(t,r,a,e.offsetX,e.offsetY),r=0,a=0,n=!1)}},Be=e=>{const t=e.getContext("2d"),n=t.fillStyle;t.clearRect(0,0,e.width,e.height),t.fillStyle="#fff",t.fillRect(0,0,Ie.current.width,Ie.current.height),t.fillStyle=n},qe=e=>{const t=e.getContext("2d");let n,r;e.onmouseup=a=>{var s=e.getBoundingClientRect();const l=a.clientX-s.left,o=a.clientY-s.top;((e,t,n,r,a)=>{let s=.5*(r-t),l=.5*(a-n),o=t+s,c=n+l,i=.01,u=i,m=2*Math.PI-i;for(e.beginPath(),e.moveTo(o+s*Math.cos(0),c+l*Math.sin(0));u<m;u+=i)e.lineTo(o+s*Math.cos(u),c+l*Math.sin(u));e.closePath(),e.stroke()})(t,n,r,l,o)},e.onmousedown=t=>{var a=e.getBoundingClientRect();n=t.clientX-a.left,r=t.clientY-a.top}},$e=e=>{e.onmousedown=null,e.onmousemove=null,e.onmouseup=null,e.onclick=null};l.exports.useEffect((()=>{((e,t)=>{const n=e.getContext("2d");n.strokeStyle=t,n.fillStyle=t})(Ie.current,ye.hex)}),[ye]);const He=(e,t)=>{t(e.target.value)};return l.exports.useEffect((()=>(Te.current=o("http://localhost:5001"),Te.current.on("connect",(()=>{console.log("socket connection established")})),()=>{Te.current.close()})),[]),l.exports.useEffect((()=>{Te.current.on("new-user-joined",(async({target:e,username:t})=>{const n=new Q(t,e);if(Re.current[e]=Fe(e,t),se((e=>[...e,n])),ue)ue.getTracks().forEach((t=>{Re.current[e].addTrack(t,ue)}));else{const t=await Re.current[e].createOffer();await Re.current[e].setLocalDescription(t),Te.current.emit("offer",{offer:Re.current[e].localDescription,target:Re.current[e].target})}}))}),[ue]),l.exports.useEffect((()=>{Te.current.on("chat",(({sender:e,text:t,date:n,id:r,role:a,rate:s,hardness:l,repliedID:o})=>{const c=new W(r,e,t,n,a,s,l,o);re((e=>[...e,c])),Ye.current.scrollTop=1e4})),Te.current.on("self-info",(e=>{e.isAdmin&&ge(!0),fe(e.username)})),Te.current.on("full-chat-update",(e=>{const t=e.map((e=>new W(e.id,e.sender,e.text,e.date,e.role,e.rate,e.hardness)));re((()=>t)),0===t.length&&Ce(null)})),Te.current.on("answer",(async({answer:e,target:t})=>{await Re.current[t].setRemoteDescription(new RTCSessionDescription(e))})),Te.current.on("offer",(async({offer:e,target:t,username:n})=>{const r=new RTCSessionDescription(e);if(!Re.current[t]){Re.current[t]=Fe(t,n);const e=new Q(n,t);se((t=>[...t,e]))}await Re.current[t].setRemoteDescription(r);const a=await Re.current[t].createAnswer();await Re.current[t].setLocalDescription(a),Te.current.emit("answer",{answer:a,target:t})})),Te.current.on("ice-candidate",(({incoming:e,target:t})=>{const n=new RTCIceCandidate(e);Re.current[t].addIceCandidate(n)})),Te.current.on("user-disconnected",(e=>{ie((t=>t.filter((t=>t.target!==e)))),se((t=>(console.log(t),t.filter((t=>t.connectionID!==e)))))}))}),[]),l.exports.useEffect((()=>{Te.current.on("update-message",(e=>{re((s=>{const l=s.findIndex((t=>t.id===e.id));if(-1!==l){const o=((e,s)=>{for(var l in s||(s={}))n.call(s,l)&&a(e,l,s[l]);if(t)for(var l of t(s))r.call(s,l)&&a(e,l,s[l]);return e})({},s[l]);o.rate=e.rate;const c=[...s.slice(0,l),o,...s.slice(l+1)];return console.log(c),c}return s}))}))}),[]),c.createElement(i,{square:!0,className:"container"},c.createElement("div",{className:"main"},c.createElement("form",{onSubmit:e=>{e.preventDefault(),Te.current.emit("join-room",{username:$,roomID:F}),oe(!0)},className:"formContainer"},c.createElement(u,{value:$,onChange:e=>{He(e,H)},required:!0,placeholder:"username..."}),c.createElement("br",null),c.createElement(u,{value:F,onChange:e=>{He(e,X)},required:!0,placeholder:"room..."}),c.createElement(m,{type:"submit"},"Join")),c.createElement("div",{className:"streamsContainer",style:{gridTemplateColumns:`repeat(${Math.floor(Math.log((ue?1:0)+ce.length===1?1:(ue?1:0)+ce.length)/Math.log(2))+1}, minmax(0, 1fr))`}},c.createElement("div",{className:"vidContainer self whiteboardContainer",style:{display:ee?"flex":"none"}},c.createElement("canvas",{width:"560",height:"360",className:"vid",id:"whiteboard",ref:Ie}),c.createElement("div",{className:"buttonsContainer"},c.createElement(d,{title:"Insert Image",arrow:!0},c.createElement(m,{component:"label"},c.createElement(f,null),c.createElement("input",{type:"file",onChange:()=>{const e=Ie.current.getContext("2d"),t=Pe.current.files[0],n=new FileReader;n.readAsDataURL(t),n.onload=t=>{if(t.target.readyState===FileReader.DONE){const n=new Image;n.src=t.target.result,n.onload=()=>{e.drawImage(n,0,0,560,360)}}}},ref:Pe,hidden:!0}))),c.createElement(d,{title:"Line",arrow:!0},c.createElement(m,{className:0===be?"selected":"",onClick:()=>{ke(0),$e(Ie.current),(e=>{const t=e.getContext("2d");let n=0,r=0;e.onmousedown=e=>{n=e.offsetX,r=e.offsetY},e.onmouseup=e=>{let a=e.offsetX,s=e.offsetY;t.beginPath(),t.lineWidth="3",t.moveTo(n,r),t.lineTo(a,s),t.stroke()}})(Ie.current)}},c.createElement(p,null))),c.createElement(d,{title:"Square",arrow:!0},c.createElement(m,{className:1===be?"selected":"",onClick:()=>{ke(1),$e(Ie.current),(e=>{const t=e.getContext("2d");let n=0,r=0;e.onmousedown=e=>{n=e.offsetX,r=e.offsetY},e.onmouseup=e=>{let a=e.offsetX-n,s=e.offsetY-r;t.beginPath(),t.rect(n,r,a,s),t.stroke()}})(Ie.current)}},c.createElement(g,null))),c.createElement(d,{title:"Circle",arrow:!0},c.createElement(m,{className:2===be?"selected":"",onClick:()=>{ke(2),$e(Ie.current),qe(Ie.current)}},c.createElement(h,null))),c.createElement(d,{title:"Text",arrow:!0},c.createElement(m,{className:3===be?"selected":"",onClick:()=>{ke(3),$e(Ie.current),(e=>{const t=e.getContext("2d");let n=0,r=0;e.onclick=e=>{n=e.offsetX,r=e.offsetY;const a=prompt("Enter Text");t.font="20px Arial",t.fillText(a,n,r)}})(Ie.current)}},c.createElement(E,null))),c.createElement(d,{title:"Draw",arrow:!0},c.createElement(m,{className:4===be?"selected":"",onClick:()=>{ke(4),$e(Ie.current),Xe(Ie.current)}},c.createElement(x,null))),c.createElement(m,{onClick:()=>{Be(Ie.current)}},"Clear"),c.createElement(v,{onClickAway:()=>{De(!1)}},c.createElement("div",{className:"cp"},c.createElement(m,{onClick:()=>{De((e=>!e))}},c.createElement(w,null)),c.createElement("div",{className:["colorPickerContainer",Ne?"show":""].join(" ")},c.createElement(C,{color:ye,width:170,onChangeComplete:Se,colors:z})))))),ue&&!ee&&c.createElement("div",{className:"vidContainer self"},c.createElement("div",{className:"username"},"You"),c.createElement("video",{className:"vid",ref:e=>{if(e)return e.srcObject=ue},muted:!0,autoPlay:!0,playsInline:!0})),ce.map((({stream:e,username:t})=>c.createElement("div",{className:"vidContainer",key:e.id},c.createElement("div",{className:"username"},t," "),c.createElement("video",{className:"vid",ref:t=>{if(t)return t.srcObject=e},muted:!0,autoPlay:!0,playsInline:!0})))))),c.createElement(i,{square:!0,className:Oe.sidebar},c.createElement("div",{className:"users"},c.createElement(b,{subheader:c.createElement(k,{component:"div",className:"listHeader"},"Users ",ae.length>0?`(${ae.length+1})`:""),style:{maxHeight:"300px",overflowY:"scroll"}},le&&c.createElement(y,null,c.createElement(S,{className:"selfUserContainer",primary:c.createElement(N,{component:"div"},de," ",c.createElement("span",{className:"caption"},"   You")," ")})),ae.map((e=>c.createElement(y,{key:e.connectionID},c.createElement(S,{primary:e.username})))))),c.createElement(D,null),c.createElement("div",{className:"messages",ref:Ye},c.createElement(b,{subheader:c.createElement(k,{className:"listHeader",component:"div"},"CHAT ",ne.length>0?`(${ne.length})`:""),disablePadding:!0},ne.map((e=>{var t;let n=e.role,r=null,a=null==(t=ne.filter((t=>t.id===e.repliedID))[0])?void 0:t.text;"question"===n&&(r=()=>{var t;t=e.id,Ce(t),Me.current.focus()});return c.createElement(V,{key:e.id,id:e.id,rate:e.rate,ratingOnChange:t=>{var n,r;n=t,r=e.id,Te.current.emit("rate-message",{messageID:r,rate:n})},sender:e.sender,repliedText:a,hardness:e.hardness,role:n,onClick:r,text:e.text,date:e.date,isAdmin:pe})})))),c.createElement(D,null),!pe&&we&&c.createElement("div",{className:"replyContainer"},c.createElement("span",{onClick:()=>{Ce(null)}},c.createElement(T,null)),"Question:  ",null==(s=ne.filter((e=>e.id===we))[0])?void 0:s.text),pe&&c.createElement("div",{className:"msgMode"},c.createElement(m,{variant:"outlined",onClick:()=>{Ee(!0)}},"Question ",he?c.createElement(R,null):""," "),c.createElement(m,{variant:"outlined",onClick:()=>{Ee(!1)}},"Message ",he?"":c.createElement(R,null)," "),he&&c.createElement(u,{type:"number",startAdornment:c.createElement(I,{position:"start",component:"label"},"Hardness: "),inputProps:{min:0,max:10},onChange:e=>{ve(e.target.value)},value:xe})),c.createElement("form",{className:"form",onSubmit:e=>{if(e.preventDefault(),""===B.trim())return;const t={text:B.trim()};pe?he&&(t.hardness=xe):we&&(t.repliedID=we),Te.current.emit("chat",t),q(""),Ce(null)}},c.createElement(u,{className:"input",placeholder:we?"Reply...":"Message...",value:B,onChange:e=>{q(e.target.value)},variant:"outlined",inputProps:{ref:Me}}),c.createElement(P,{type:"submit","aria-label":"Send Message"},c.createElement(M,null)))),c.createElement(i,{className:Oe.nav},c.createElement(P,{onClick:()=>{J(ue,"audio",Z),_(!Z)},"aria-label":"Share Microphone"},Z?c.createElement(Y,null):c.createElement(O,null)),c.createElement(P,{onClick:()=>{J(ue,"video",L),K(!L)},"aria-label":"Share Desktop"},L?c.createElement(j,null):c.createElement(A,null)),c.createElement(m,{onClick:async()=>{const e=await new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((t=>{e(t)})).catch((()=>{t()}))}));for(const t in Re.current)e.getTracks().forEach((n=>{Re.current[t].addTrack(n,e)}));me(e)}},"Share webcam"),c.createElement(m,{onClick:async()=>{const e=await new Promise(((e,t)=>{navigator.mediaDevices.getDisplayMedia({video:!0}).then((t=>{e(t)})).catch((()=>{t()}))}));for(const t in Re.current)e.getTracks().forEach((n=>{Re.current[t].addTrack(n,e)}));me(e)}},"Share Desktop"),c.createElement(m,{onClick:()=>{Be(Ie.current),Xe(Ie.current);const e=Ie.current.captureStream(30),t=e.getVideoTracks()[0];for(const n in Re.current)Re.current[n].addTrack(t,e);me(e),te(!0)}},"Create Whiteboard"),pe&&c.createElement(m,{onClick:()=>{Te.current.emit("clear-chat")}},"clear chat")))}function Z(){const[e,t]=l.exports.useState(!0),n=B({props:{MuiButtonBase:{disableRipple:!0}},palette:{type:e?"dark":"light",primary:{main:e?"#757575":"#01579B"},secondary:{light:"#0066ff",main:"#0044ff",contrastText:"#ffcc00"}},shape:{borderRadius:0},overrides:{MuiPaper:{elevation1:{background:e?"#21242b":null,"box-shadow":"0 0px 15px 0 rgba(0,0,0,.08)"}}}});return c.createElement(q,{theme:n},c.createElement($,null,c.createElement(H,{exact:!0,path:"/",component:()=>c.createElement(K,{setDarkTheme:t,darkTheme:e})})))}L.render(c.createElement(c.StrictMode,null,c.createElement(Z,null)),document.getElementById("root"));
