import{m as e,r as t,i as r,R as a,P as n,I as o,B as c,c as s,T as i,a as l,b as d,d as u}from"./vendor.3e0293a6.js";const m=e((e=>({root:{height:"100vh"},input:{border:"1px rgba(255,0,255,0.5) solid",margin:"10px 0 0 0",padding:"5px"}}))),p=(e,t)=>{t(e.target.value)},f=()=>new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((t=>{e(t)})).catch((()=>{t()}))})),g=()=>{const e=m(),[s,i]=t.exports.useState(""),[l,d]=t.exports.useState("room1"),[u,g]=t.exports.useState([]),h=t.exports.useRef(null),w=t.exports.useRef(null);class E{constructor(e,t){this.stream=e,this.target=t}}const b=e=>{const t=new RTCPeerConnection;return t.onicecandidate=e=>{((e,t)=>{e.candidate?w.current.emit("ice-candidate",{target:t.target,candidate:e.candidate}):console.log("peer connected")})(e,t)},t.ontrack=t=>{((e,t)=>{const r=new E(e.streams[0],t);g((e=>[...e.filter((e=>e.stream.id!==r.stream.id)),r]))})(t,e)},t.onnegotiationneeded=()=>(async e=>{console.log("handle negotiation needed fired");const t=await e.createOffer();await e.setLocalDescription(t),console.log("new offer",e.localDescription),w.emit("offer",{offer:e.localDescription,target:e.target})})(t),t.target=e,t};t.exports.useEffect((()=>{w.current=r("http://localhost:5001");const e=[];return w.current.on("connect",(()=>{console.log("socket connection established")})),w.current.on("new-user-joined",(async t=>{const r=b(t);e[t]=r;const a=await f();h.current.srcObject=a,a.getTracks().forEach((e=>{r.addTrack(e,a)}));const n=await r.createOffer();await r.setLocalDescription(n),w.current.emit("offer",{offer:n,target:t})})),w.current.on("recieve-offer",(async({offer:t,target:r})=>{const a=b(r);e[r]=a;const n=await f();h.current.srcObject=n,n.getTracks().forEach((e=>{a.addTrack(e,n)})),await a.setRemoteDescription(new RTCSessionDescription(t));const o=await a.createAnswer();a.setLocalDescription(o),w.current.emit("answer",{answer:o,target:r})})),w.current.on("recieve-answer",(async({answer:t,target:r})=>{await e[r].setRemoteDescription(new RTCSessionDescription(t))})),w.current.on("ice-candidate",(({incoming:t,target:r})=>{const a=new RTCIceCandidate(t);e[r].addIceCandidate(a)})),w.current.on("user-disconnected",(e=>{g((t=>t.filter((t=>t.target!==e))))})),()=>{w.current.close()}}),[]);return a.createElement(n,{className:e.root},a.createElement("form",{onSubmit:e=>{e.preventDefault(),w.current.emit("join-room",{username:s,roomID:l})}},a.createElement(o,{value:s,onChange:e=>{p(e,i)},className:e.input,placeholder:"username..."}),a.createElement("br",null),a.createElement(o,{value:l,onChange:e=>{p(e,d)},className:e.input,placeholder:"room..."}),a.createElement(c,{type:"submit"},"Join")),a.createElement("video",{style:{width:"45%"},ref:h,muted:!0,autoPlay:!0,playsInline:!0}),u.map((({stream:e})=>a.createElement("video",{key:e.id,ref:t=>{if(t)return t.srcObject=e},muted:!0,style:{width:"45%"},autoPlay:!0,playsInline:!0}))))};function h(){const[e,r]=t.exports.useState(!0),n=s({props:{MuiButtonBase:{disableRipple:!0}},palette:{type:e?"dark":"light",primary:{main:e?"#757575":"#01579B"},secondary:{light:"#0066ff",main:"#0044ff",contrastText:"#ffcc00"}},shape:{borderRadius:0},overrides:{MuiPaper:{elevation1:{background:e?"#21242b":null,"box-shadow":"0 0px 15px 0 rgba(0,0,0,.08)"}}}});return a.createElement(i,{theme:n},a.createElement(l,null,a.createElement(d,{exact:!0,path:"/v2",component:g})))}u.render(a.createElement(a.StrictMode,null,a.createElement(h,null)),document.getElementById("root"));
