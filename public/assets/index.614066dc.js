import{m as e,i as t,r as a,R as n,P as r,I as o,B as c,c as s,T as i,a as l,b as d,d as m}from"./vendor.3e0293a6.js";const u=e((e=>({root:{height:"100vh"},input:{border:"1px rgba(255,0,255,0.5) solid",margin:"10px 0 0 0",padding:"5px"}}))),p=(e,t)=>{t(e.target.value)},f=()=>new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((t=>{e(t)})).catch((()=>{t()}))})),g=(e,t)=>{e.candidate?h.emit("ice-candidate",{target:t.target,candidate:e.candidate}):console.log("peer connected",t)},h=t("http://localhost:5001"),w=()=>{const e=u(),[t,s]=a.exports.useState(""),[i,l]=a.exports.useState("room1"),[d,m]=a.exports.useState([]),w=a.exports.useRef(null),b=e=>{const t=e.streams[0];m((e=>[...e.filter((e=>e.id!==t.id)),t]))};a.exports.useEffect((()=>{const e=[];return h.on("connect",(()=>{console.log("socket connection established")})),h.on("new-user-joined",(async t=>{console.log(`user ${t} joined room`);const a=new RTCPeerConnection;a.target=t,e[t]=a;const n=await f();w.current.srcObject=n,n.getTracks().forEach((e=>{a.addTrack(e,n)})),a.onicecandidate=e=>{g(e,a)},a.ontrack=b;const r=await a.createOffer();await a.setLocalDescription(r),h.emit("offer",{offer:r,target:t})})),h.on("recieve-offer",(async({offer:t,target:a})=>{const n=new RTCPeerConnection;e[a]=n,n.target=a;const r=await f();w.current.srcObject=r,r.getTracks().forEach((e=>{n.addTrack(e,r)})),n.onicecandidate=e=>{g(e,n)},n.ontrack=b,await n.setRemoteDescription(t);const o=await n.createAnswer();n.setLocalDescription(o),h.emit("answer",{answer:o,target:a})})),h.on("recieve-answer",(async({answer:t,target:a})=>{await e[a].setRemoteDescription(t)})),h.on("ice-candidate",(({incoming:t,target:a})=>{const n=new RTCIceCandidate(t);e[a].addIceCandidate(n)})),()=>{h.close()}}),[]);return n.createElement(r,{className:e.root},n.createElement("form",{onSubmit:e=>{e.preventDefault(),h.emit("join-room",{username:t,roomID:i})}},n.createElement(o,{value:t,onChange:e=>{p(e,s)},className:e.input,placeholder:"username..."}),n.createElement("br",null),n.createElement(o,{value:i,onChange:e=>{p(e,l)},className:e.input,placeholder:"room..."}),n.createElement(c,{type:"submit"},"Submit")),d.map((e=>n.createElement("video",{key:e.id,ref:t=>{if(t)return t.srcObject=e},muted:!0,style:{width:"45%"},autoPlay:!0,playsInline:!0}))),n.createElement("video",{ref:w,muted:!0,style:{width:"45%"},autoPlay:!0,playsInline:!0}))};function b(){const[e,t]=a.exports.useState(!0),r=s({props:{MuiButtonBase:{disableRipple:!0}},palette:{type:e?"dark":"light",primary:{main:e?"#757575":"#01579B"},secondary:{light:"#0066ff",main:"#0044ff",contrastText:"#ffcc00"}},shape:{borderRadius:0},overrides:{MuiPaper:{elevation1:{background:e?"#21242b":null,"box-shadow":"0 0px 15px 0 rgba(0,0,0,.08)"}}}});return n.createElement(i,{theme:r},n.createElement(l,null,n.createElement(d,{exact:!0,path:"/v2",component:w})))}m.render(n.createElement(n.StrictMode,null,n.createElement(b,null)),document.getElementById("root"));
